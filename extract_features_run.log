11/13/2025 22:51:48 - INFO - __main__ - 使用设备: cuda
11/13/2025 22:51:48 - INFO - __main__ - 加载训练数据集...
11/13/2025 22:51:48 - WARNING - datasets.builder - Reusing dataset hr_doc (/mnt/e/models/HuggingFace/datasets/hr_doc/hrdoc/1.0.0/4c62f5fd2f5b7fad274a87898b36e7b64e8aa65887c5fa3032f1095fe6e989c7)
11/13/2025 22:51:48 - INFO - __main__ - 加载模型...
11/13/2025 22:52:16 - INFO - __main__ - Tokenizing数据...
11/13/2025 22:52:16 - WARNING - datasets.fingerprint - Parameter 'function'=<function main.<locals>.tokenize_and_align_labels at 0x74b56b46df70> of the transform datasets.arrow_dataset.Dataset._map_single couldn't be hashed properly, a random hash was used instead. Make sure your transforms and parameters are serializable with pickle or dill for the dataset fingerprinting and caching to work. If you reuse this transform, the caching mechanism will consider it to be different from the previous calls and recompute everything. This warning is only showed once. Subsequent hashing failures won't be showed.
  0%|          | 0/1 [00:00<?, ?ba/s]100%|██████████| 1/1 [00:01<00:00,  1.49s/ba]100%|██████████| 1/1 [00:01<00:00,  1.49s/ba]11/13/2025 22:52:17 - INFO - __main__ - 开始提取行级特征...

提取特征:   0%|          | 0/132 [00:00<?, ?it/s]/root/miniforge3/envs/layoutlmv2/lib/python3.8/site-packages/detectron2/structures/image_list.py:88: UserWarning: __floordiv__ is deprecated, and its behavior will change in a future version of pytorch. It currently rounds toward 0 (like the 'trunc' function NOT 'floor'). This results in incorrect rounding for negative values. To keep the current behavior, use torch.div(a, b, rounding_mode='trunc'), or for actual floor division, use torch.div(a, b, rounding_mode='floor').
  max_size = (max_size + (stride - 1)) // stride * stride
/root/code/layoutlmft/layoutlmft/models/layoutlmv2/modeling_layoutlmv2.py:718: UserWarning: __floordiv__ is deprecated, and its behavior will change in a future version of pytorch. It currently rounds toward 0 (like the 'trunc' function NOT 'floor'). This results in incorrect rounding for negative values. To keep the current behavior, use torch.div(a, b, rounding_mode='trunc'), or for actual floor division, use torch.div(a, b, rounding_mode='floor').
  torch.arange(
/root/code/layoutlmft/layoutlmft/models/layoutlmv2/modeling_layoutlmv2.py:728: UserWarning: __floordiv__ is deprecated, and its behavior will change in a future version of pytorch. It currently rounds toward 0 (like the 'trunc' function NOT 'floor'). This results in incorrect rounding for negative values. To keep the current behavior, use torch.div(a, b, rounding_mode='trunc'), or for actual floor division, use torch.div(a, b, rounding_mode='floor').
  torch.arange(
提取特征:   1%|          | 1/132 [00:00<00:56,  2.33it/s]提取特征:   2%|▏         | 2/132 [00:00<00:46,  2.79it/s]提取特征:   2%|▏         | 3/132 [00:00<00:38,  3.32it/s]提取特征:   3%|▎         | 4/132 [00:00<00:34,  3.74it/s]提取特征:   4%|▍         | 5/132 [00:01<00:30,  4.11it/s]提取特征:   5%|▍         | 6/132 [00:01<00:28,  4.43it/s]提取特征:   5%|▌         | 7/132 [00:01<00:25,  4.81it/s]提取特征:   6%|▌         | 8/132 [00:01<00:23,  5.21it/s]提取特征:   7%|▋         | 9/132 [00:01<00:21,  5.60it/s]提取特征:   8%|▊         | 10/132 [00:02<00:24,  5.08it/s]提取特征:   8%|▊         | 11/132 [00:02<00:23,  5.05it/s]提取特征:   9%|▉         | 12/132 [00:02<00:23,  5.00it/s]提取特征:  10%|▉         | 13/132 [00:02<00:23,  5.16it/s]提取特征:  11%|█         | 14/132 [00:02<00:20,  5.69it/s]提取特征:  11%|█▏        | 15/132 [00:02<00:19,  5.97it/s]提取特征:  12%|█▏        | 16/132 [00:03<00:18,  6.20it/s]提取特征:  13%|█▎        | 17/132 [00:03<00:19,  5.99it/s]提取特征:  14%|█▎        | 18/132 [00:03<00:19,  5.83it/s]提取特征:  14%|█▍        | 19/132 [00:03<00:18,  6.22it/s]提取特征:  15%|█▌        | 20/132 [00:03<00:17,  6.37it/s]提取特征:  16%|█▌        | 21/132 [00:03<00:17,  6.37it/s]提取特征:  17%|█▋        | 22/132 [00:04<00:17,  6.14it/s]提取特征:  17%|█▋        | 23/132 [00:04<00:17,  6.30it/s]提取特征:  18%|█▊        | 24/132 [00:04<00:18,  5.92it/s]提取特征:  19%|█▉        | 25/132 [00:04<00:18,  5.77it/s]提取特征:  20%|█▉        | 26/132 [00:04<00:18,  5.85it/s]提取特征:  20%|██        | 27/132 [00:04<00:16,  6.22it/s]提取特征:  21%|██        | 28/132 [00:05<00:16,  6.50it/s]提取特征:  22%|██▏       | 29/132 [00:05<00:15,  6.82it/s]提取特征:  23%|██▎       | 30/132 [00:05<00:15,  6.56it/s]提取特征:  23%|██▎       | 31/132 [00:05<00:16,  6.12it/s]提取特征:  24%|██▍       | 32/132 [00:05<00:16,  6.11it/s]提取特征:  25%|██▌       | 33/132 [00:05<00:16,  6.08it/s]提取特征:  26%|██▌       | 34/132 [00:05<00:15,  6.13it/s]提取特征:  27%|██▋       | 35/132 [00:06<00:14,  6.53it/s]提取特征:  27%|██▋       | 36/132 [00:06<00:14,  6.86it/s]提取特征:  28%|██▊       | 37/132 [00:06<00:13,  6.87it/s]提取特征:  29%|██▉       | 38/132 [00:06<00:13,  6.74it/s]提取特征:  30%|██▉       | 39/132 [00:06<00:13,  7.02it/s]提取特征:  30%|███       | 40/132 [00:06<00:14,  6.21it/s]提取特征:  31%|███       | 41/132 [00:07<00:14,  6.11it/s]提取特征:  32%|███▏      | 42/132 [00:07<00:13,  6.56it/s]提取特征:  33%|███▎      | 43/132 [00:07<00:15,  5.70it/s]提取特征:  33%|███▎      | 44/132 [00:07<00:16,  5.46it/s]提取特征:  34%|███▍      | 45/132 [00:07<00:14,  5.85it/s]提取特征:  35%|███▍      | 46/132 [00:07<00:14,  6.12it/s]提取特征:  36%|███▌      | 47/132 [00:08<00:14,  6.06it/s]提取特征:  36%|███▋      | 48/132 [00:08<00:13,  6.41it/s]提取特征:  37%|███▋      | 49/132 [00:08<00:13,  6.25it/s]提取特征:  38%|███▊      | 50/132 [00:08<00:13,  6.03it/s]提取特征:  39%|███▊      | 51/132 [00:08<00:14,  5.74it/s]提取特征:  39%|███▉      | 52/132 [00:08<00:13,  5.94it/s]提取特征:  40%|████      | 53/132 [00:09<00:13,  6.03it/s]提取特征:  41%|████      | 54/132 [00:09<00:12,  6.48it/s]提取特征:  42%|████▏     | 55/132 [00:09<00:11,  6.50it/s]提取特征:  42%|████▏     | 56/132 [00:09<00:12,  6.32it/s]提取特征:  43%|████▎     | 57/132 [00:09<00:12,  6.07it/s]提取特征:  44%|████▍     | 58/132 [00:09<00:12,  6.16it/s]提取特征:  45%|████▍     | 59/132 [00:10<00:12,  5.95it/s]提取特征:  45%|████▌     | 60/132 [00:10<00:12,  5.63it/s]提取特征:  46%|████▌     | 61/132 [00:10<00:12,  5.55it/s]提取特征:  47%|████▋     | 62/132 [00:10<00:14,  4.92it/s]提取特征:  48%|████▊     | 63/132 [00:10<00:13,  4.99it/s]提取特征:  48%|████▊     | 64/132 [00:11<00:14,  4.54it/s]提取特征:  49%|████▉     | 65/132 [00:11<00:15,  4.26it/s]提取特征:  50%|█████     | 66/132 [00:11<00:14,  4.53it/s]提取特征:  51%|█████     | 67/132 [00:11<00:15,  4.20it/s]提取特征:  52%|█████▏    | 68/132 [00:12<00:14,  4.46it/s]提取特征:  52%|█████▏    | 69/132 [00:12<00:13,  4.76it/s]提取特征:  53%|█████▎    | 70/132 [00:12<00:12,  4.95it/s]提取特征:  54%|█████▍    | 71/132 [00:12<00:11,  5.48it/s]提取特征:  55%|█████▍    | 72/132 [00:12<00:10,  5.60it/s]提取特征:  55%|█████▌    | 73/132 [00:12<00:11,  5.07it/s]提取特征:  56%|█████▌    | 74/132 [00:13<00:11,  5.06it/s]提取特征:  57%|█████▋    | 75/132 [00:13<00:11,  5.11it/s]提取特征:  58%|█████▊    | 76/132 [00:13<00:10,  5.28it/s]提取特征:  58%|█████▊    | 77/132 [00:13<00:09,  5.66it/s]提取特征:  59%|█████▉    | 78/132 [00:13<00:09,  5.83it/s]提取特征:  60%|█████▉    | 79/132 [00:13<00:08,  6.16it/s]提取特征:  61%|██████    | 80/132 [00:14<00:08,  6.29it/s]提取特征:  61%|██████▏   | 81/132 [00:14<00:07,  6.40it/s]提取特征:  62%|██████▏   | 82/132 [00:14<00:09,  5.47it/s]提取特征:  63%|██████▎   | 83/132 [00:14<00:09,  5.20it/s]提取特征:  64%|██████▎   | 84/132 [00:14<00:09,  5.19it/s]提取特征:  64%|██████▍   | 85/132 [00:15<00:08,  5.54it/s]提取特征:  65%|██████▌   | 86/132 [00:15<00:07,  6.13it/s]提取特征:  66%|██████▌   | 87/132 [00:15<00:07,  5.79it/s]提取特征:  67%|██████▋   | 88/132 [00:15<00:08,  5.23it/s]提取特征:  67%|██████▋   | 89/132 [00:15<00:07,  5.44it/s]提取特征:  68%|██████▊   | 90/132 [00:15<00:07,  5.46it/s]提取特征:  69%|██████▉   | 91/132 [00:16<00:07,  5.69it/s]提取特征:  70%|██████▉   | 92/132 [00:16<00:06,  5.72it/s]提取特征:  70%|███████   | 93/132 [00:16<00:06,  5.91it/s]提取特征:  71%|███████   | 94/132 [00:16<00:06,  5.89it/s]提取特征:  72%|███████▏  | 95/132 [00:16<00:06,  5.82it/s]提取特征:  73%|███████▎  | 96/132 [00:16<00:05,  6.04it/s]提取特征:  73%|███████▎  | 97/132 [00:17<00:05,  5.99it/s]提取特征:  74%|███████▍  | 98/132 [00:17<00:05,  5.69it/s]提取特征:  75%|███████▌  | 99/132 [00:17<00:06,  5.41it/s]提取特征:  76%|███████▌  | 100/132 [00:17<00:05,  5.51it/s]提取特征:  77%|███████▋  | 101/132 [00:17<00:05,  6.16it/s]提取特征:  77%|███████▋  | 102/132 [00:17<00:04,  6.15it/s]提取特征:  78%|███████▊  | 103/132 [00:18<00:05,  5.72it/s]提取特征:  79%|███████▉  | 104/132 [00:18<00:04,  6.07it/s]提取特征:  80%|███████▉  | 105/132 [00:18<00:04,  6.01it/s]提取特征:  80%|████████  | 106/132 [00:18<00:04,  6.08it/s]提取特征:  81%|████████  | 107/132 [00:18<00:04,  6.21it/s]提取特征:  82%|████████▏ | 108/132 [00:19<00:04,  5.92it/s]提取特征:  83%|████████▎ | 109/132 [00:19<00:04,  5.75it/s]提取特征:  83%|████████▎ | 110/132 [00:19<00:04,  5.44it/s]提取特征:  84%|████████▍ | 111/132 [00:19<00:03,  5.51it/s]提取特征:  85%|████████▍ | 112/132 [00:19<00:03,  5.87it/s]提取特征:  86%|████████▌ | 113/132 [00:19<00:03,  5.86it/s]提取特征:  86%|████████▋ | 114/132 [00:20<00:03,  5.83it/s]提取特征:  87%|████████▋ | 115/132 [00:20<00:03,  5.63it/s]提取特征:  88%|████████▊ | 116/132 [00:20<00:02,  5.43it/s]提取特征:  89%|████████▊ | 117/132 [00:20<00:02,  5.03it/s]提取特征:  89%|████████▉ | 118/132 [00:20<00:02,  5.47it/s]提取特征:  90%|█████████ | 119/132 [00:21<00:02,  5.02it/s]提取特征:  91%|█████████ | 120/132 [00:21<00:02,  5.17it/s]提取特征:  92%|█████████▏| 121/132 [00:21<00:02,  5.28it/s]提取特征:  92%|█████████▏| 122/132 [00:21<00:01,  5.32it/s]提取特征:  93%|█████████▎| 123/132 [00:21<00:01,  4.95it/s]提取特征:  94%|█████████▍| 124/132 [00:22<00:01,  5.03it/s]提取特征:  95%|█████████▍| 125/132 [00:22<00:01,  5.11it/s]提取特征:  95%|█████████▌| 126/132 [00:22<00:01,  5.32it/s]提取特征:  96%|█████████▌| 127/132 [00:22<00:00,  5.22it/s]提取特征:  97%|█████████▋| 128/132 [00:22<00:00,  5.34it/s]提取特征:  98%|█████████▊| 129/132 [00:22<00:00,  5.71it/s]提取特征:  98%|█████████▊| 130/132 [00:23<00:00,  5.05it/s]提取特征:  99%|█████████▉| 131/132 [00:23<00:00,  5.02it/s]提取特征: 100%|██████████| 132/132 [00:23<00:00,  5.17it/s]提取特征: 100%|██████████| 132/132 [00:23<00:00,  5.60it/s]11/13/2025 22:52:41 - INFO - __main__ - 保存特征到 ./data/line_features/train_line_features.pkl
11/13/2025 22:52:41 - INFO - __main__ - ✓ 完成！共提取 132 页的特征
11/13/2025 22:52:41 - INFO - __main__ -   特征维度: torch.Size([1, 61, 768])
11/13/2025 22:52:41 - INFO - __main__ -   保存路径: ./data/line_features/train_line_features.pkl

