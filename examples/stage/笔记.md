```shell
  # 完整训练
  python examples/stage/util/extract_line_features_document_level.py \
    --data_dir /home/linux/code/data/HRDS \
    --model_path /home/linux/code/layoutlmft/models/checkpoint-5000 \
    --output_dir /home/linux/code/layoutlmft/output/line_features_doc

  # 快速测试（10个文档）
  python examples/stage/util/extract_line_features_document_level.py \
    --data_dir /home/linux/code/data/HRDS \
    --model_path /home/linux/code/layoutlmft/models/checkpoint-5000 \
    --output_dir /home/linux/code/layoutlmft/output/line_features_doc_test \
    --num_samples 10 \
    --docs_per_chunk 5


```

完整的文档级别训练流程脚本位置：

  当前脚本结构：
  - Stage 1: examples/stage/run_hrdoc.py - LayoutLMv2 微调
  - Stage 2: examples/stage/util/extract_line_features_document_level.py - 文档级特征提取
  - Stage 3: examples/stage/train_parent_finder.py - ParentFinder 训练（支持 --level document）
  - Stage 4: examples/stage/train_multiclass_relation.py - 关系分类器训练

```shell
tmux new -s train


# Stage 1
python examples/stage/scripts/train_stage1.py --env dev --quick
python examples/stage/scripts/train_stage1.py --env test --dataset hrds

--env dev 
--quick
--new_exp: 创建新实验
--restart: 忽略现有 checkpoint，从头开始
--init_from hrds
--covmatch
nohup python examples/stage/scripts/train_stage1.py --env test --dataset hrdh --init_from hrdh > logs/train_stage1_$(date +%Y%m%d_%H%M%S).log 2>&1 &
tail -f $(ls -t logs/*.log | head -1)

nohup python examples/stage/train_joint.py --env test --dataset hrdh > logs/train_joint_$(date +%Y%m%d_%H%M%S).log 2>&1 &

python examples/stage/train_joint.py --env test --dataset hrdh --model_path /data/LLM_group/layoutlmft/artifact/exp_20251216_231629/stage1_hrdh/checkpoint-2500

nohup python examples/stage/train_joint.py --env test --dataset hrdh --model_path /data/LLM_group/layoutlmft/artifact/exp_20251216_231629/stage1_hrdh/checkpoint-2500 > logs/train_joint_$(date +%Y%m%d_%H%M%S).log 2>&1 &

# 训练
  python examples/stage/train_joint.py \
      --env test \
      --dataset hrds \
      --covmatch doc_covmatch_dev25_seed42 \
      --model_path /data/LLM_group/layoutlmft/artifact/exp_20251216_231629/stage1_hrdh/checkpoint-2500 \
      --eval_steps 25 \
      --min_steps 1000  \
      --use_cache \
      --document_level
      
      --stage1_no_grad false  \
      --per_device_train_batch_size 1

      

# 推理
  python examples/infer/run_joint_infer.py \
      --env test \
      --dataset tender \
      --model_path /data/LLM_group/layoutlmft/artifact/exp_20251216_231629/joint_tender/checkpoint-1000 \
      --skip_eval


```


