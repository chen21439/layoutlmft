
# 行间transformer   
stage1_hrdh: /data/LLM_group/layoutlmft/artifact/joint_train/stage1_hrdh_line_enhancement/best
stage1_tender: /data/LLM_group/layoutlmft/artifact/tender/stage1_tender_line_enhancement/best

construct_backup: /data/LLM_group/layoutlmft/artifact_comp_hrdoc/construct_line_enhancement_tender1/

# 无行间transformer最佳模型：
/data/LLM_group/layoutlmft/artifact/tender/stage34_tender1/best/

这里定义batch=document

sample batch epoch: 数据单位
step/it: 训练单位

1.完整训练hrds确认重构的代码正常使用 2.训练hrds的stage1  3.继续hrdh的stage1 4.联合训练

# 训练
```shell
  cd /data/LLM_group/layoutlmft && \
  conda activate layoutxlm && \
  nohup python examples/stage/train_joint.py \
      --env test \
      --min_steps 1000  \
      --gradient_checkpointing  \
      --per_device_train_batch_size 1 \
      --dataset hrdh \
      --covmatch doc_covmatch_dev12_seed42 \
      --eval_before_train \
      --freeze_visual \
      --stage1_no_grad true  \
      --model_name_or_path /data/LLM_group/layoutlmft/artifact/test_speed/joint_hrds/checkpoint-150  \
      --report_to tensorboard \
      --save_predictions  \
      --new_exp test_speed_hrdh  \
      > logs/train_joint_$(date +%Y%m%d_%H%M%S).log 2>&1 &

      --freeze_visual \
      --section_parent_weight 5.0 \
      --use_soft_mask true \
      --new_exp \
      --mode joint / stage1 / stage34
      
            --new_exp
            --model_path /data/LLM_group/layoutlmft/artifact/exp_20251226_145417/joint_tender/checkpoint-25 \
        python examples/stage/train_joint.py \
      --env test \
      --min_steps 1000  \
      --gradient_checkpointing  \
      --stage1_no_grad false  \
      --per_device_train_batch_size 1 \
      --model_path /data/LLM_group/layoutlmft/artifact/exp_20251226_145417/joint_hrds/checkpoint-1075 \
      --use_soft_mask true \
      --freeze_visual \
      --gpu 1  \
      --dataset hrdh \
      ----covmatch doc_covmatch_dev12_seed42 \
      > logs/train_joint_$(date +%Y%m%d_%H%M%S).log 2>&1 &
      
            
            --new_exp
            --freeze_visual \
```

# covmatch

```shell
  python examples/stage/scripts/create_dev_covmatch.py \
    --env test --dataset tender --mode random --dev_count 2 --seed 99

python examples/stage/scripts/create_dev_covmatch.py --env test \
  --dataset hrdh --dev_ratio 0.1 --seed 42
```

# 推理

```shell

  cd /data/LLM_group/layoutlmft && \
  conda activate layoutxlm && \      
 python examples/stage/scripts/infer.py \
      --env test \
      --checkpoint /data/LLM_group/layoutlmft/artifact/tender/stage1_tender/best \
      --data_dir /data/LLM_group/ontology/static/upload/79 \
      --output_dir /data/LLM_group/ontology/static/upload/79

      
            --skip_eval
```

/tender_after_hrdh              数据流为hrds->hrdh->tender   tender
/exp_hrdh   hrdh
/data/LLM_group/layoutlmft/artifact/exp_20251227_161829     hrds tender
test_speed  hrds在当前代码下能进行学习并保存的模型