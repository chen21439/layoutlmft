# DOC (Detect-Order-Construct) 模型训练配置

# 环境配置
env: dev  # dev 或 test

# GPU 配置
gpu:
  dev: null    # dev 环境不指定 GPU
  test: "1"    # test 环境使用 GPU 1

# 数据路径（根据 env 自动选择）
data:
  # dev 环境
  dev:
    root: "/mnt/e/models/data/Section/Comp_HRDoc"
    train_dir: "/mnt/e/models/data/Section/Comp_HRDoc/HRDH_MSRA_POD_TRAIN"
    test_dir: "/mnt/e/models/data/Section/Comp_HRDoc/HRDH_MSRA_POD_TEST"

  # test 环境（服务器）
  test:
    root: "/data/LLM_group/layoutlmft/data/Comp_HRDoc"
    train_dir: "/data/LLM_group/layoutlmft/data/Comp_HRDoc/HRDH_MSRA_POD_TRAIN"
    test_dir: "/data/LLM_group/layoutlmft/data/Comp_HRDoc/HRDH_MSRA_POD_TEST"

  # 通用配置
  max_regions: 128
  val_split_ratio: 0.1
  use_images: false

# 模型配置
model:
  # 模型类型：doc (完整) 或 order-only (仅阅读顺序)
  model_type: doc

  # 隐藏层维度
  hidden_size: 768

  # 类别数 (Comp_HRDoc: 0=pad, 1=fig, 2=tab, 3=para, 4=other)
  num_categories: 5

  # Transformer 配置
  num_heads: 12
  order_num_layers: 3      # Order 模块层数
  construct_num_layers: 3  # Construct 模块层数
  dropout: 0.1

  # 特征配置
  use_spatial: true       # 使用空间兼容性特征
  use_visual: false       # 使用视觉特征 (需要图像)
  use_text: false         # 使用文本特征 (需要 tokenizer)
  use_construct: true     # 使用 Construct 模块

  # 关系类型数
  num_relations: 3  # 0=无关系, 1=文本顺序, 2=图形关系

# 训练配置
training:
  batch_size: 4
  learning_rate: 5.0e-5
  weight_decay: 0.01
  warmup_ratio: 0.1
  num_epochs: 20
  gradient_accumulation_steps: 2
  fp16: false  # A100/3090 可以开启

  # 保存和日志
  save_steps: 500
  log_steps: 50
  eval_steps: 200

# 输出配置
output:
  output_dir: "outputs/doc_model"
